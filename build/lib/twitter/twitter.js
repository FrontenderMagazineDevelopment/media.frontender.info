'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _isomorphicFetch=require('isomorphic-fetch');var _isomorphicFetch2=_interopRequireDefault(_isomorphicFetch);var _crypto=require('crypto');var _crypto2=_interopRequireDefault(_crypto);var _oauth=require('oauth-1.0a');var _oauth2=_interopRequireDefault(_oauth);var _urlencode=require('urlencode');var _urlencode2=_interopRequireDefault(_urlencode);var _formdata=require('formdata');var _formdata2=_interopRequireDefault(_formdata);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var request=require('request');var qs=require('qs');/**
 * @class Twitter â€” set of methods to work with twitter api using promises
 */var Twitter=function(){/**
     * @constructor
     */function Twitter(){_classCallCheck(this,Twitter);this.config={consumer_key:process.env.TWITTER_CUSTOMER_KEY,consumer_key_secret:process.env.TWITTER_CUSTOMER_KEY_SECRET,access_tocken:process.env.TWITTER_TOKEN,access_tocken_secret:process.env.TWITTER_TOKEN_SECRET};this.oauth=(0,_oauth2.default)({consumer:{key:this.config.consumer_key,secret:this.config.consumer_key_secret},signature_method:'HMAC-SHA1',hash_function:function hash_function(baseString,key){return _crypto2.default.createHmac('sha1',key).update(baseString).digest('base64')}});this.token={key:this.config.access_tocken,secret:this.config.access_tocken_secret};this.urls={api:'https://api.twitter.com/1.1/',search_users:'users/search.json?page=1&count=2&q=',tweet:'statuses/update.json'}}/**
   * Tweet your message
   * @param  {string} status  - The text of the status update. URL encode as necessary. t.co link wrapping will affect character counts.
   * @return {Promise}        - promise with tweeting process
   */_createClass(Twitter,[{key:'tweet',value:function(){var _ref=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(status){var request_data,options,response,json;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:request_data={url:this.urls.api+this.urls.tweet,method:'POST',data:{status:status}};options={url:request_data.url,method:request_data.method,headers:_extends({'Content-Type':'application/x-www-form-urlencoded','Accept':'application/json'},this.oauth.toHeader(this.oauth.authorize(request_data,this.token))),body:encodeURIComponent('status')+'='+encodeURIComponent(status)};_context.next=4;return(0,_isomorphicFetch2.default)(request_data.url,options);case 4:response=_context.sent;if(!response.ok){_context.next=10;break}_context.next=8;return response.json();case 8:json=_context.sent;return _context.abrupt('return',json);case 10:throw new Error(response.status+' '+response.statusText);case 11:case'end':return _context.stop();}}},_callee,this)}));function tweet(_x){return _ref.apply(this,arguments)}return tweet}()/**
   * Search for users
   * @param {Array} keywords
   * @return {Promise}
   */},{key:'searchForUsers',value:function searchForUsers(keywordsList){var _this=this;var keywords=!Array.isArray(keywordsList)&&typeof keywordsList==='string'?new Array(keywordsList):keywordsList;var promises=keywords.map(function(keyword){return _this.searchForUser(keyword)});return Promise.all(promises)}/**
     * Search for user
     * @param {String} keyword
     * @return {Promise}
     */},{key:'searchForUser',value:function(){var _ref2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(keyword){var url,options,response,json,users;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:url=this.urls.api+this.urls.search_users+encodeURIComponent(keyword);options={headers:this.oauth.toHeader(this.oauth.authorize({url:url,method:'GET'},this.token)),json:true};_context2.next=4;return(0,_isomorphicFetch2.default)(url,options);case 4:response=_context2.sent;if(!response.ok){_context2.next=11;break}_context2.next=8;return response.json();case 8:json=_context2.sent;users=json.map(function(user){var name=user.name,screen_name=user.screen_name,entities=user.entities,profile_image_url=user.profile_image_url;var urls=Object.values(entities).map(function(entitie){return entitie.urls.map(function(uri){return uri.expanded_url})}).reduce(function(a,b){return a.concat(b)});return{name:name,login:screen_name,urls:urls,profile_image_url:profile_image_url}});return _context2.abrupt('return',users);case 11:throw new Error(response.status+' '+response.statusText);case 12:case'end':return _context2.stop();}}},_callee2,this)}));function searchForUser(_x2){return _ref2.apply(this,arguments)}return searchForUser}()}]);return Twitter}();exports.default=Twitter;
//# sourceMappingURL=twitter.js.map